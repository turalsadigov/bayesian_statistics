<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Your Name">
<meta name="dcterms.date" content="2022-12-30">

<title>Bayes Rules! - Bayesian Simple Linear Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="bayes_rules_chapter_9_files/libs/clipboard/clipboard.min.js"></script>
<script src="bayes_rules_chapter_9_files/libs/quarto-html/quarto.js"></script>
<script src="bayes_rules_chapter_9_files/libs/quarto-html/popper.min.js"></script>
<script src="bayes_rules_chapter_9_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="bayes_rules_chapter_9_files/libs/quarto-html/anchor.min.js"></script>
<link href="bayes_rules_chapter_9_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="bayes_rules_chapter_9_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="bayes_rules_chapter_9_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="bayes_rules_chapter_9_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="bayes_rules_chapter_9_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="bayes_rules_chapter_9_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="bayes_rules_chapter_9_files/libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="bayes_rules_chapter_9_files/libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="bayes_rules_chapter_9_files/libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="bayes_rules_chapter_9_files/libs/typedarray-0.1/typedarray.min.js"></script>
<script src="bayes_rules_chapter_9_files/libs/jquery-3.5.1/jquery.min.js"></script>
<link href="bayes_rules_chapter_9_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="bayes_rules_chapter_9_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="bayes_rules_chapter_9_files/libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="bayes_rules_chapter_9_files/libs/plotly-main-2.5.1/plotly-latest.min.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Bayes Rules! - Bayesian Simple Linear Regression</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Your Name </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 30, 2022</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#bayesian-slr" id="toc-bayesian-slr" class="nav-link active" data-scroll-target="#bayesian-slr">Bayesian SLR</a></li>
  <li><a href="#example-bike-sharing-dataset" id="toc-example-bike-sharing-dataset" class="nav-link" data-scroll-target="#example-bike-sharing-dataset">Example: Bike Sharing dataset</a></li>
  <li><a href="#markov-chain-monte-carlo" id="toc-markov-chain-monte-carlo" class="nav-link" data-scroll-target="#markov-chain-monte-carlo">Markov Chain Monte Carlo</a></li>
  <li><a href="#predictions" id="toc-predictions" class="nav-link" data-scroll-target="#predictions">Predictions</a></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="cell" data-hash="bayes_rules_chapter_9_cache/html/unnamed-chunk-1_1b9febe516338eb7dc3878b14f3ddda4">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Libraries</p>
<div class="cell" data-hash="bayes_rules_chapter_9_cache/html/unnamed-chunk-2_13a634e729650fea6dad2e18ec486400">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesrules)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom.mixed)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="bayesian-slr" class="level2">
<h2 class="anchored" data-anchor-id="bayesian-slr">Bayesian SLR</h2>
<p>Bayesian SLR adds prior assumptions to the parameters that we try to learn.</p>
<p><span class="math display">\[
Y| \beta_0, \beta_1, \sigma \sim Normal(\beta_0 + \beta_1x, \sigma^2)
\]</span></p>
<p><span class="math display">\[
\beta_0 \sim Normal(m_0, s_0^2)
\]</span></p>
<p><span class="math display">\[
\beta_1 \sim Normal(m_1, s_1^2)
\]</span></p>
<p><span class="math display">\[
\sigma \sim Exp(l)
\]</span></p>
</section>
<section id="example-bike-sharing-dataset" class="level2">
<h2 class="anchored" data-anchor-id="example-bike-sharing-dataset">Example: Bike Sharing dataset</h2>
<div class="cell" data-hash="bayes_rules_chapter_9_cache/html/unnamed-chunk-3_a5b813b3090960e425a97d9a7f96bac9">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 500 × 13
   date       season  year month day_o…¹ weekend holiday temp_…² temp_…³ humid…⁴
   &lt;date&gt;     &lt;fct&gt;  &lt;int&gt; &lt;fct&gt; &lt;fct&gt;   &lt;lgl&gt;   &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1 2011-01-01 winter  2011 Jan   Sat     TRUE    no         57.4    64.7    80.6
 2 2011-01-03 winter  2011 Jan   Mon     FALSE   no         46.5    49.0    43.7
 3 2011-01-04 winter  2011 Jan   Tue     FALSE   no         46.8    51.1    59.0
 4 2011-01-05 winter  2011 Jan   Wed     FALSE   no         48.7    52.6    43.7
 5 2011-01-07 winter  2011 Jan   Fri     FALSE   no         46.5    50.8    49.9
 6 2011-01-08 winter  2011 Jan   Sat     TRUE    no         44.2    46.6    53.6
 7 2011-01-10 winter  2011 Jan   Mon     FALSE   no         43.1    45.6    48.3
 8 2011-01-11 winter  2011 Jan   Tue     FALSE   no         44.5    49.2    68.6
 9 2011-01-12 winter  2011 Jan   Wed     FALSE   no         44.7    46.4    60.0
10 2011-01-13 winter  2011 Jan   Thu     FALSE   no         44.2    45.6    47.0
# … with 490 more rows, 3 more variables: windspeed &lt;dbl&gt;, weather_cat &lt;fct&gt;,
#   rides &lt;int&gt;, and abbreviated variable names ¹​day_of_week, ²​temp_actual,
#   ³​temp_feel, ⁴​humidity</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      date               season         year          month     day_of_week
 Min.   :2011-01-01   fall  :164   Min.   :2011   Mar    : 58   Fri:73     
 1st Qu.:2011-05-21   spring:139   1st Qu.:2011   Nov    : 57   Mon:71     
 Median :2012-01-11   summer: 38   Median :2012   Dec    : 56   Sat:74     
 Mean   :2012-01-02   winter:159   Mean   :2012   Apr    : 55   Sun:67     
 3rd Qu.:2012-06-01                3rd Qu.:2012   Oct    : 54   Thu:71     
 Max.   :2012-12-31                Max.   :2012   Feb    : 52   Tue:79     
                                                  (Other):168   Wed:65     
  weekend        holiday    temp_actual      temp_feel        humidity    
 Mode :logical   no :488   Min.   :42.65   Min.   :45.46   Min.   : 0.00  
 FALSE:359       yes: 12   1st Qu.:55.17   1st Qu.:59.88   1st Qu.:51.57  
 TRUE :141                 Median :62.90   Median :69.24   Median :63.35  
                           Mean   :63.33   Mean   :69.14   Mean   :63.44  
                           3rd Qu.:72.11   3rd Qu.:79.44   3rd Qu.:74.47  
                           Max.   :85.38   Max.   :86.94   Max.   :97.25  
                                                                          
   windspeed      weather_cat      rides     
 Min.   : 1.500   categ1:290   Min.   :  20  
 1st Qu.: 8.906   categ2:191   1st Qu.:2208  
 Median :12.532   categ3: 19   Median :3490  
 Mean   :13.019                Mean   :3482  
 3rd Qu.:15.917                3rd Qu.:4624  
 Max.   :34.000                Max.   :6946  
                                             </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rides)) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">'white'</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="bayes_rules_chapter_9_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> rides)) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="bayes_rules_chapter_9_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> <span class="fu">log</span>(rides))) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="bayes_rules_chapter_9_files/figure-html/unnamed-chunk-3-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> temp_feel, <span class="at">y =</span> rides)) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">'lm'</span>, <span class="at">se =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="bayes_rules_chapter_9_files/figure-html/unnamed-chunk-3-4.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">cor</span>(temp_feel, rides))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cor(temp_feel, rides)
1             0.5824898</code></pre>
</div>
</div>
<p>Based on past bikeshare analyses, suppose we have the following prior understanding of this relationship:</p>
<p><strong>Observation</strong>: On an average temperature day, say 65 or 70 degrees for D.C., there are typically around 5000 riders, though this average could be somewhere between 3000 and 7000. What does it mean? <span class="math display">\[y = \beta_1(x - 70) + \beta_0\]</span></p>
<p>Since <span class="math inline">\((7000-3000)/4 = 1000\)</span>, <span class="math display">\[\beta_0 \sim Normal(m_0 = 5000, s_0^2 = 1000^2)\]</span>.</p>
<p><strong>Observation</strong>: For every one degree increase in temperature, ridership typically increases by 100 rides, though this average increase could be as low as 20 or as high as 180. What does it mean? Since, <span class="math inline">\((180 - 20)/4 = 40\)</span>,</p>
<p><span class="math display">\[\beta_1 \sim Normal(\mu_1 = 100, s_1^2 = 40^2)\]</span></p>
<p><strong>Observation</strong>: At any given temperature, daily ridership will tend to vary with a moderate standard deviation of 1250 rides. What does it mean? <span class="math inline">\(\frac{1}{l} = 1250\)</span>, i.e, <span class="math inline">\(l = \frac{1}{1250}=\)</span> 8^{-4}. Thus,</p>
<p><span class="math display">\[\sigma \sim Exp(l = 0.0008)\]</span></p>
<p>We have our priors for the model parameters.</p>
<div class="cell" data-hash="bayes_rules_chapter_9_cache/html/unnamed-chunk-4_cf04a504ad2f2d266b763918caca47ea">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_normal</span>(<span class="at">mean =</span> <span class="dv">5000</span>, <span class="at">sd =</span> <span class="dv">1000</span>) <span class="sc">+</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"beta_0c"</span>, <span class="at">y =</span> <span class="st">"pdf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="bayes_rules_chapter_9_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_normal</span>(<span class="at">mean =</span> <span class="dv">100</span>, <span class="at">sd =</span> <span class="dv">40</span>) <span class="sc">+</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"beta_1"</span>, <span class="at">y =</span> <span class="st">"pdf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="bayes_rules_chapter_9_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_gamma</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">rate =</span> <span class="fl">0.0008</span>) <span class="sc">+</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"sigma"</span>, <span class="at">y =</span> <span class="st">"pdf"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="bayes_rules_chapter_9_files/figure-html/unnamed-chunk-4-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="markov-chain-monte-carlo" class="level2">
<h2 class="anchored" data-anchor-id="markov-chain-monte-carlo">Markov Chain Monte Carlo</h2>
<ul>
<li>Dynamical system</li>
<li>Not deterministic</li>
<li>Looking for a steady state solution</li>
<li>‘Attractor’ in the parameter space</li>
<li>Distribution in the attractor is the posterior distribution</li>
</ul>
<div class="cell" data-hash="bayes_rules_chapter_9_cache/html/unnamed-chunk-5_a9fb174181c6c76f8b12f460cafe14f3">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>bike_model <span class="ot">&lt;-</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stan_glm</span>(rides <span class="sc">~</span> temp_feel, </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> bikes,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> gaussian,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">prior_intercept =</span> <span class="fu">normal</span>(<span class="dv">5000</span>, <span class="dv">1000</span>),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">prior =</span> <span class="fu">normal</span>(<span class="dv">100</span>, <span class="dv">40</span>), </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">prior_aux =</span> <span class="fu">exponential</span>(<span class="fl">0.0008</span>),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">iter =</span> <span class="dv">5000</span><span class="sc">*</span><span class="dv">2</span>, </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">seed =</span> <span class="dv">84735</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
SAMPLING FOR MODEL 'continuous' NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 6.4e-05 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.64 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:    1 / 10000 [  0%]  (Warmup)
Chain 1: Iteration: 1000 / 10000 [ 10%]  (Warmup)
Chain 1: Iteration: 2000 / 10000 [ 20%]  (Warmup)
Chain 1: Iteration: 3000 / 10000 [ 30%]  (Warmup)
Chain 1: Iteration: 4000 / 10000 [ 40%]  (Warmup)
Chain 1: Iteration: 5000 / 10000 [ 50%]  (Warmup)
Chain 1: Iteration: 5001 / 10000 [ 50%]  (Sampling)
Chain 1: Iteration: 6000 / 10000 [ 60%]  (Sampling)
Chain 1: Iteration: 7000 / 10000 [ 70%]  (Sampling)
Chain 1: Iteration: 8000 / 10000 [ 80%]  (Sampling)
Chain 1: Iteration: 9000 / 10000 [ 90%]  (Sampling)
Chain 1: Iteration: 10000 / 10000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 0.215584 seconds (Warm-up)
Chain 1:                0.309724 seconds (Sampling)
Chain 1:                0.525308 seconds (Total)
Chain 1: 

SAMPLING FOR MODEL 'continuous' NOW (CHAIN 2).
Chain 2: 
Chain 2: Gradient evaluation took 1e-05 seconds
Chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.1 seconds.
Chain 2: Adjust your expectations accordingly!
Chain 2: 
Chain 2: 
Chain 2: Iteration:    1 / 10000 [  0%]  (Warmup)
Chain 2: Iteration: 1000 / 10000 [ 10%]  (Warmup)
Chain 2: Iteration: 2000 / 10000 [ 20%]  (Warmup)
Chain 2: Iteration: 3000 / 10000 [ 30%]  (Warmup)
Chain 2: Iteration: 4000 / 10000 [ 40%]  (Warmup)
Chain 2: Iteration: 5000 / 10000 [ 50%]  (Warmup)
Chain 2: Iteration: 5001 / 10000 [ 50%]  (Sampling)
Chain 2: Iteration: 6000 / 10000 [ 60%]  (Sampling)
Chain 2: Iteration: 7000 / 10000 [ 70%]  (Sampling)
Chain 2: Iteration: 8000 / 10000 [ 80%]  (Sampling)
Chain 2: Iteration: 9000 / 10000 [ 90%]  (Sampling)
Chain 2: Iteration: 10000 / 10000 [100%]  (Sampling)
Chain 2: 
Chain 2:  Elapsed Time: 0.275764 seconds (Warm-up)
Chain 2:                0.283785 seconds (Sampling)
Chain 2:                0.559549 seconds (Total)
Chain 2: 

SAMPLING FOR MODEL 'continuous' NOW (CHAIN 3).
Chain 3: 
Chain 3: Gradient evaluation took 9e-06 seconds
Chain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.09 seconds.
Chain 3: Adjust your expectations accordingly!
Chain 3: 
Chain 3: 
Chain 3: Iteration:    1 / 10000 [  0%]  (Warmup)
Chain 3: Iteration: 1000 / 10000 [ 10%]  (Warmup)
Chain 3: Iteration: 2000 / 10000 [ 20%]  (Warmup)
Chain 3: Iteration: 3000 / 10000 [ 30%]  (Warmup)
Chain 3: Iteration: 4000 / 10000 [ 40%]  (Warmup)
Chain 3: Iteration: 5000 / 10000 [ 50%]  (Warmup)
Chain 3: Iteration: 5001 / 10000 [ 50%]  (Sampling)
Chain 3: Iteration: 6000 / 10000 [ 60%]  (Sampling)
Chain 3: Iteration: 7000 / 10000 [ 70%]  (Sampling)
Chain 3: Iteration: 8000 / 10000 [ 80%]  (Sampling)
Chain 3: Iteration: 9000 / 10000 [ 90%]  (Sampling)
Chain 3: Iteration: 10000 / 10000 [100%]  (Sampling)
Chain 3: 
Chain 3:  Elapsed Time: 0.281978 seconds (Warm-up)
Chain 3:                0.294287 seconds (Sampling)
Chain 3:                0.576265 seconds (Total)
Chain 3: 

SAMPLING FOR MODEL 'continuous' NOW (CHAIN 4).
Chain 4: 
Chain 4: Gradient evaluation took 6e-06 seconds
Chain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.06 seconds.
Chain 4: Adjust your expectations accordingly!
Chain 4: 
Chain 4: 
Chain 4: Iteration:    1 / 10000 [  0%]  (Warmup)
Chain 4: Iteration: 1000 / 10000 [ 10%]  (Warmup)
Chain 4: Iteration: 2000 / 10000 [ 20%]  (Warmup)
Chain 4: Iteration: 3000 / 10000 [ 30%]  (Warmup)
Chain 4: Iteration: 4000 / 10000 [ 40%]  (Warmup)
Chain 4: Iteration: 5000 / 10000 [ 50%]  (Warmup)
Chain 4: Iteration: 5001 / 10000 [ 50%]  (Sampling)
Chain 4: Iteration: 6000 / 10000 [ 60%]  (Sampling)
Chain 4: Iteration: 7000 / 10000 [ 70%]  (Sampling)
Chain 4: Iteration: 8000 / 10000 [ 80%]  (Sampling)
Chain 4: Iteration: 9000 / 10000 [ 90%]  (Sampling)
Chain 4: Iteration: 10000 / 10000 [100%]  (Sampling)
Chain 4: 
Chain 4:  Elapsed Time: 0.189801 seconds (Warm-up)
Chain 4:                0.29564 seconds (Sampling)
Chain 4:                0.485441 seconds (Total)
Chain 4: </code></pre>
</div>
</div>
<p>Dynamics in the phase space (i.e., parameter space)</p>
<div class="cell" data-hash="bayes_rules_chapter_9_cache/html/unnamed-chunk-6_40dc349ff35c1ff232e503ef3fe75648">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>bike_model <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(time = rep(1:50, 1)) %&gt;% </span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>(<span class="at">n =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_ly</span>(<span class="at">x =</span> <span class="sc">~</span><span class="fu">log</span>(<span class="sc">-</span>intercept), </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="sc">~</span>temp_feel<span class="sc">/</span><span class="dv">10</span>, </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">z =</span> <span class="sc">~</span>sigma,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">type =</span> <span class="st">'scatter3d'</span>, </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">mode =</span> <span class="st">'lines'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_markers</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">scene =</span> <span class="fu">list</span>(<span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'beta_0'</span>),</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'beta_1'</span>),</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">'sigma'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-e9bdf0bad9c756436c4f" style="width:100%;height:464px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-e9bdf0bad9c756436c4f">{"x":{"visdat":{"16fea4e7f263c":["function () ","plotlyVisDat"]},"cur_data":"16fea4e7f263c","attrs":{"16fea4e7f263c":{"x":{},"y":{},"z":{},"mode":"lines","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"},"16fea4e7f263c.1":{"x":{},"y":{},"z":{},"mode":"markers","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"beta_0"},"yaxis":{"title":"beta_1"},"zaxis":{"title":"sigma"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[7.67315514812878,7.74712512347367,7.73617409949215,7.68963420600945,7.76454645872156,7.66679884309229,7.7427343735525,7.80153328619732,7.52064201007275,7.87558284263264,7.67529422683093,7.53000146084044,7.70979793896431,7.79119016415615,7.72293444152508,7.61193050416908,7.76562756398941,7.52070885424632,7.79182492492541,7.95361877123975,7.95102316047945,7.34762263676185,7.95607594344542,7.4279225943594,7.9796275359795,7.81904126014166,7.64892188317837,7.90287832845445,7.89418240609041,7.81442083471063,7.76124135066488,7.67721502734346,7.72966019677176,7.77968943725392,7.73852605382012,7.78694506273824,7.59153780477891,7.34886095232065,7.40638702309329,7.54614808255645,7.81721229557037,7.68976110371051,7.67386603808462,7.81613758324747,7.99602091237424,7.79953395422255,7.61550280958492,7.52721027258577,7.68566103564314,7.53548119185049,7.814692598818,7.75126392359131,7.63229240627098,7.81022595461488,7.83293662324546,7.49395808913033,7.79036926957058,7.71781404419906,7.68499908539561,7.90252631684953,7.59160465107446,7.76591673481852,7.70387795022393,7.53505920585362,7.46581627206239,7.91677040603372,7.59178748491762,7.72650687939918,7.69573479986506,7.55032903311203,7.81701028869717,7.75963769423536,7.62336187663079,7.72958942512028,7.66471569081382,7.81681614645668,7.65027279943137,7.69199430193151,7.44695599225595,7.73147801389931,7.73244420769495,7.81731821863166,7.53170054967671,7.6061136304077,7.67193253424075,7.76243299434998,7.64820146147379,7.79115807534673,7.68920660741307,7.65097219156008,7.65428132167071,7.64820527188829,7.57359535503347,7.40773778640701,7.9008046212317,7.5551494835836,7.79430668579094,7.44884500304336,7.50821877217544,7.52544294898169],"y":[8.18840019820535,8.36452201841342,8.48586902751534,8.21364398575811,8.51076715385684,8.17853192020119,8.34648322394102,8.52215486786141,7.68081226033771,8.87529480929075,8.2527727735927,7.64012582443552,8.2827904245738,8.51367962159975,8.22069319166962,8.05105879555508,8.32429458970658,7.75080309777902,8.54558271761295,9.09298868838657,9.05098505737387,7.3884807946725,9.03968557980002,7.58763801253984,9.13438013913073,8.67232123218395,7.99664618465186,9.04670808510333,8.95086649807307,8.63807441446,8.40676839335037,8.21054715688562,8.23470792086479,8.56435221816523,8.4211381362676,8.56466570690928,7.8322153447871,7.31701522944016,7.44835877570828,7.76227372014635,8.60613994977867,8.27807867090364,8.1975782123227,8.55661627577211,9.31813137962873,8.69463260914287,8.08087879552069,7.73251064370491,8.19522944969439,7.77790171430407,8.63947076258595,8.44029034714121,7.9077137872535,8.71140574339688,8.76271326949431,7.56376769654122,8.62623257126699,8.17135020577304,8.21973491654257,9.03434314110112,7.86863480562861,8.58296708345857,8.38053327127351,7.79751437671638,7.43456588289137,9.15112725151035,7.83876980530469,8.29284555765351,8.17224494553913,7.81486156900397,8.61583478805568,8.46787589951898,8.05945911243116,8.50176448510426,7.95317546525404,8.79257636549225,7.89703474034869,8.41004496218689,7.53542786504422,8.34015186133249,8.34725739578701,8.63517804098254,7.70333812078575,7.88031895255602,8.11658609715561,8.45568888882963,8.06142904099639,8.56809253329702,8.24745585246653,8.18588150127381,8.00093063850923,8.21522454339486,7.91761504070494,7.51320115124004,8.86188129333491,7.74796712449277,8.64868369820869,7.46748828753773,7.61044639578392,7.78228927460526],"z":[1283.36947598129,1271.04697993251,1272.6267907617,1288.97254355895,1276.07653392239,1314.41078036553,1272.46227792165,1250.97788107657,1275.57273512827,1282.83804837749,1325.13288772512,1269.87145514004,1283.92737559742,1238.99774547907,1224.92115671878,1319.36556647248,1261.53993437618,1302.2873897938,1278.47865307615,1231.21459924757,1265.64292978853,1277.50510684245,1305.37823491422,1211.81907393005,1353.87931068914,1344.28003216582,1230.41119022083,1367.88119385701,1363.7769164732,1360.26560372483,1311.65357807134,1244.77082415251,1281.91031520043,1297.07809879453,1288.1666031256,1374.87785631107,1199.43821915375,1198.18458979588,1234.58512897561,1248.07607673286,1332.60841292781,1217.65647342613,1206.69854954522,1369.71449111411,1274.98149878305,1290.58367956534,1334.65857236634,1250.59540409412,1327.95685356434,1374.66638039423,1201.08133410674,1170.36833851395,1437.0130270651,1238.46386979321,1192.77088542434,1368.80629235119,1194.92728182389,1339.29286402893,1262.30284178278,1257.41540520705,1268.98504581941,1277.76300586248,1203.81454115527,1334.77198786604,1284.90669860686,1298.06141487288,1281.67455195015,1317.52791835023,1327.47332928661,1247.14459066733,1296.85047281287,1251.49708384174,1203.1650935856,1249.36254188162,1299.10415036868,1266.20404796585,1319.85549801072,1248.83941578983,1301.79014684624,1257.88501247605,1285.37876337802,1320.55768176554,1269.48617439937,1212.99824905303,1258.46060793276,1295.43466207679,1277.3877675971,1323.17011331565,1324.59925553787,1308.59450943952,1280.50101605073,1309.63925341814,1279.94187711935,1278.47217586372,1270.95020426357,1244.80026122936,1326.64676428388,1247.93288526077,1296.18028115502,1231.36500249562],"mode":"lines","type":"scatter3d","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"frame":null},{"x":[7.67315514812878,7.74712512347367,7.73617409949215,7.68963420600945,7.76454645872156,7.66679884309229,7.7427343735525,7.80153328619732,7.52064201007275,7.87558284263264,7.67529422683093,7.53000146084044,7.70979793896431,7.79119016415615,7.72293444152508,7.61193050416908,7.76562756398941,7.52070885424632,7.79182492492541,7.95361877123975,7.95102316047945,7.34762263676185,7.95607594344542,7.4279225943594,7.9796275359795,7.81904126014166,7.64892188317837,7.90287832845445,7.89418240609041,7.81442083471063,7.76124135066488,7.67721502734346,7.72966019677176,7.77968943725392,7.73852605382012,7.78694506273824,7.59153780477891,7.34886095232065,7.40638702309329,7.54614808255645,7.81721229557037,7.68976110371051,7.67386603808462,7.81613758324747,7.99602091237424,7.79953395422255,7.61550280958492,7.52721027258577,7.68566103564314,7.53548119185049,7.814692598818,7.75126392359131,7.63229240627098,7.81022595461488,7.83293662324546,7.49395808913033,7.79036926957058,7.71781404419906,7.68499908539561,7.90252631684953,7.59160465107446,7.76591673481852,7.70387795022393,7.53505920585362,7.46581627206239,7.91677040603372,7.59178748491762,7.72650687939918,7.69573479986506,7.55032903311203,7.81701028869717,7.75963769423536,7.62336187663079,7.72958942512028,7.66471569081382,7.81681614645668,7.65027279943137,7.69199430193151,7.44695599225595,7.73147801389931,7.73244420769495,7.81731821863166,7.53170054967671,7.6061136304077,7.67193253424075,7.76243299434998,7.64820146147379,7.79115807534673,7.68920660741307,7.65097219156008,7.65428132167071,7.64820527188829,7.57359535503347,7.40773778640701,7.9008046212317,7.5551494835836,7.79430668579094,7.44884500304336,7.50821877217544,7.52544294898169],"y":[8.18840019820535,8.36452201841342,8.48586902751534,8.21364398575811,8.51076715385684,8.17853192020119,8.34648322394102,8.52215486786141,7.68081226033771,8.87529480929075,8.2527727735927,7.64012582443552,8.2827904245738,8.51367962159975,8.22069319166962,8.05105879555508,8.32429458970658,7.75080309777902,8.54558271761295,9.09298868838657,9.05098505737387,7.3884807946725,9.03968557980002,7.58763801253984,9.13438013913073,8.67232123218395,7.99664618465186,9.04670808510333,8.95086649807307,8.63807441446,8.40676839335037,8.21054715688562,8.23470792086479,8.56435221816523,8.4211381362676,8.56466570690928,7.8322153447871,7.31701522944016,7.44835877570828,7.76227372014635,8.60613994977867,8.27807867090364,8.1975782123227,8.55661627577211,9.31813137962873,8.69463260914287,8.08087879552069,7.73251064370491,8.19522944969439,7.77790171430407,8.63947076258595,8.44029034714121,7.9077137872535,8.71140574339688,8.76271326949431,7.56376769654122,8.62623257126699,8.17135020577304,8.21973491654257,9.03434314110112,7.86863480562861,8.58296708345857,8.38053327127351,7.79751437671638,7.43456588289137,9.15112725151035,7.83876980530469,8.29284555765351,8.17224494553913,7.81486156900397,8.61583478805568,8.46787589951898,8.05945911243116,8.50176448510426,7.95317546525404,8.79257636549225,7.89703474034869,8.41004496218689,7.53542786504422,8.34015186133249,8.34725739578701,8.63517804098254,7.70333812078575,7.88031895255602,8.11658609715561,8.45568888882963,8.06142904099639,8.56809253329702,8.24745585246653,8.18588150127381,8.00093063850923,8.21522454339486,7.91761504070494,7.51320115124004,8.86188129333491,7.74796712449277,8.64868369820869,7.46748828753773,7.61044639578392,7.78228927460526],"z":[1283.36947598129,1271.04697993251,1272.6267907617,1288.97254355895,1276.07653392239,1314.41078036553,1272.46227792165,1250.97788107657,1275.57273512827,1282.83804837749,1325.13288772512,1269.87145514004,1283.92737559742,1238.99774547907,1224.92115671878,1319.36556647248,1261.53993437618,1302.2873897938,1278.47865307615,1231.21459924757,1265.64292978853,1277.50510684245,1305.37823491422,1211.81907393005,1353.87931068914,1344.28003216582,1230.41119022083,1367.88119385701,1363.7769164732,1360.26560372483,1311.65357807134,1244.77082415251,1281.91031520043,1297.07809879453,1288.1666031256,1374.87785631107,1199.43821915375,1198.18458979588,1234.58512897561,1248.07607673286,1332.60841292781,1217.65647342613,1206.69854954522,1369.71449111411,1274.98149878305,1290.58367956534,1334.65857236634,1250.59540409412,1327.95685356434,1374.66638039423,1201.08133410674,1170.36833851395,1437.0130270651,1238.46386979321,1192.77088542434,1368.80629235119,1194.92728182389,1339.29286402893,1262.30284178278,1257.41540520705,1268.98504581941,1277.76300586248,1203.81454115527,1334.77198786604,1284.90669860686,1298.06141487288,1281.67455195015,1317.52791835023,1327.47332928661,1247.14459066733,1296.85047281287,1251.49708384174,1203.1650935856,1249.36254188162,1299.10415036868,1266.20404796585,1319.85549801072,1248.83941578983,1301.79014684624,1257.88501247605,1285.37876337802,1320.55768176554,1269.48617439937,1212.99824905303,1258.46060793276,1295.43466207679,1277.3877675971,1323.17011331565,1324.59925553787,1308.59450943952,1280.50101605073,1309.63925341814,1279.94187711935,1278.47217586372,1270.95020426357,1244.80026122936,1326.64676428388,1247.93288526077,1296.18028115502,1231.36500249562],"mode":"markers","type":"scatter3d","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell" data-hash="bayes_rules_chapter_9_cache/html/unnamed-chunk-7_14e95b17d6478b39e5f1620798110d79">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Trace plots of parallel chains</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(bike_model, <span class="at">size =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="bayes_rules_chapter_9_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Density plots of parallel chains</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_dens_overlay</span>(bike_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="bayes_rules_chapter_9_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="bayes_rules_chapter_9_cache/html/unnamed-chunk-8_09605ff46c26c7f944b446b501368054">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model parameters</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(bike_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  term        estimate std.error
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)  -2194.     362.  
2 temp_feel       82.2      5.15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(bike_model, </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">effects =</span> <span class="fu">c</span>(<span class="st">"fixed"</span>, <span class="st">"aux"</span>),</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">conf.int =</span> <span class="cn">TRUE</span>, </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">conf.level =</span> <span class="fl">0.80</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  term        estimate std.error conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)  -2194.     362.    -2656.    -1732. 
2 temp_feel       82.2      5.15     75.6      88.8
3 sigma         1281.      40.7    1231.     1336. 
4 mean_PPD      3487.      80.4    3385.     3591. </code></pre>
</div>
</div>
<div class="cell" data-hash="bayes_rules_chapter_9_cache/html/unnamed-chunk-9_f7037430a13faf009357e3fcb29510c5">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 50 simulated model lines</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_fitted_draws</span>(bike_model, <span class="at">n =</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> temp_feel, <span class="at">y =</span> rides)) <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> .value, <span class="at">group =</span> .draw), <span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> bikes, <span class="at">size =</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="bayes_rules_chapter_9_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>How many coefficients (beta_1) is below or equal to 0?</p>
<div class="cell" data-hash="bayes_rules_chapter_9_cache/html/unnamed-chunk-10_7f36841f3e21f4690fdd0db71bb09434">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>bike_model <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(temp_feel <span class="sc">&lt;=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 3
# … with 3 variables: (Intercept) &lt;dbl&gt;, temp_feel &lt;dbl&gt;, sigma &lt;dbl&gt;</code></pre>
</div>
</div>
<p>What about variation?</p>
<div class="cell" data-hash="bayes_rules_chapter_9_cache/html/unnamed-chunk-11_cc0031be78bab73639adef9a1cfbc8ab">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>bikes <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predicted_draws</span>(bike_model, <span class="at">n =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> temp_feel, <span class="at">y =</span> rides)) <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> .prediction, <span class="at">group =</span> .draw), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> .draw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="bayes_rules_chapter_9_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="predictions" class="level2">
<h2 class="anchored" data-anchor-id="predictions">Predictions</h2>
<ul>
<li>Sampling variation (ys)</li>
<li>Posterior parameter variation (betas, sigma)</li>
</ul>
<p>Predict possibe predictions for x = 75?</p>
<div class="cell" data-hash="bayes_rules_chapter_9_cache/html/unnamed-chunk-12_c52dc846f938e1c17c9f00215257a30a">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">84735</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  bike_model <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mu_x_75 =</span> temp_feel<span class="sc">*</span><span class="dv">75</span> <span class="sc">+</span> intercept ) <span class="sc">%&gt;%</span> </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">preds_75 =</span> <span class="fu">rnorm</span>(<span class="dv">20000</span>, mu_x_75, sigma))</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>df2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20,000 × 5
   intercept temp_feel sigma mu_x_75 preds_75
       &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
 1    -2657.      88.2 1323.   3955.    4838.
 2    -2188.      83.0 1323.   4038.    3874.
 3    -1984.      81.5 1363.   4132.    5196.
 4    -2242.      82.5 1265.   3945.    4244.
 5    -1641.      74.7 1289.   3963.    4989.
 6    -3079.      94.8 1252.   4028.    6010.
 7    -1713.      75.6 1355.   3957.    4027.
 8    -1351.      71.0 1358.   3975.    6482.
 9    -2500.      84.7 1243.   3850.    4245.
10    -2194.      82.5 1253.   3995.    4619.
# … with 19,990 more rows</code></pre>
</div>
</div>
<div class="cell" data-hash="bayes_rules_chapter_9_cache/html/unnamed-chunk-13_a8700724512478044494e3e00c1b6940">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> preds_75, <span class="at">fill =</span> <span class="st">'blue'</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> mu_x_75, <span class="at">fill =</span> <span class="st">'red'</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="bayes_rules_chapter_9_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>rstan predictions</p>
<div class="cell" data-hash="bayes_rules_chapter_9_cache/html/unnamed-chunk-14_88cbec90c8f3896d67d583f8fdef3f0b">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">84735</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>shortcut_prediction <span class="ot">&lt;-</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_predict</span>(bike_model, </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">temp_feel =</span> <span class="dv">75</span>))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>shortcut_prediction <span class="sc">%&gt;%</span> </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20,000 × 1
   .[,"1"]
     &lt;dbl&gt;
 1   4838.
 2   3874.
 3   5196.
 4   4244.
 5   4989.
 6   6010.
 7   4027.
 8   6482.
 9   4245.
10   4619.
# … with 19,990 more rows</code></pre>
</div>
</div>
<p>What is missing?</p>
<ul>
<li>9.6: sequential regression modeling</li>
<li>9.7: different rstan priors</li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>